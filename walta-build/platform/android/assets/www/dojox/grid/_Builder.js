//>>built
define("dojox/grid/_Builder","../main,dojo/_base/array,dojo/_base/lang,dojo/_base/window,dojo/_base/event,dojo/_base/sniff,dojo/_base/connect,dojo/dnd/Moveable,dojox/html/metrics,./util,dojo/_base/html".split(","),function(r,s,j,l,t,u,x,y,A,p,g){var m=r.grid,v=function(a){for(;a&&"TABLE"!=a.tagName;a=a.parentNode);return a},z=function(a,c){for(var b=a;b&&c(b);b=b.parentNode);return b},w=p.rowIndexTag,q=p.gridViewTag,n=m._Builder=j.extend(function(a){if(a)this.view=a,this.grid=a.grid},{view:null,_table:'<table class="dojoxGridRowTable" border="0" cellspacing="0" cellpadding="0" role="presentation"',
getTableArray:function(){var a=[this._table];this.view.viewWidth&&a.push([' style="width:',this.view.viewWidth,';"'].join(""));a.push(">");return a},generateCellMarkup:function(a,c,b,f){var e=[],d;if(f){d=a.index!=a.grid.getSortIndex()?"":0<a.grid.sortInfo?'aria-sort="ascending"':'aria-sort="descending"';if(!a.id)a.id=this.grid.id+"Hdr"+a.index;d=['<th tabIndex="-1" aria-readonly="true" role="columnheader"',d,'id="',a.id,'"']}else d=['<td tabIndex="-1" role="gridcell"',this.grid.editable&&!a.editable?
'aria-readonly="true"':""];a.colSpan&&d.push(' colspan="',a.colSpan,'"');a.rowSpan&&d.push(' rowspan="',a.rowSpan,'"');d.push(' class="dojoxGridCell ');a.classes&&d.push(a.classes," ");b&&d.push(b," ");e.push(d.join(""));e.push("");d=['" idx="',a.index,'" style="'];c&&";"!=c[c.length-1]&&(c+=";");d.push(a.styles,c||"",a.hidden?"display:none;":"");a.unitWidth&&d.push("width:",a.unitWidth,";");e.push(d.join(""));e.push("");d=['"'];a.attrs&&d.push(" ",a.attrs);d.push(">");e.push(d.join(""));e.push("");
e.push(f?"</th>":"</td>");return e},isCellNode:function(a){return Boolean(a&&a!=l.doc&&g.attr(a,"idx"))},getCellNodeIndex:function(a){return a?Number(g.attr(a,"idx")):-1},getCellNode:function(a,c){for(var b=0,f;(f=a.firstChild&&((a.firstChild.rows||0)[b]||a.firstChild.childNodes[b]))&&f.cells;b++)for(var e=0,d;d=f.cells[e];e++)if(this.getCellNodeIndex(d)==c)return d;return null},findCellTarget:function(a,c){for(var b=a;b&&(!this.isCellNode(b)||b.offsetParent&&q in b.offsetParent.parentNode&&b.offsetParent.parentNode[q]!=
this.view.id)&&b!=c;)b=b.parentNode;return b!=c?b:null},baseDecorateEvent:function(a){a.dispatch="do"+a.type;a.grid=this.grid;a.sourceView=this.view;a.cellNode=this.findCellTarget(a.target,a.rowNode);a.cellIndex=this.getCellNodeIndex(a.cellNode);a.cell=0<=a.cellIndex?this.grid.getCell(a.cellIndex):null},findTarget:function(a,c){for(var b=a;b&&b!=this.domNode&&(!(c in b)||q in b&&b[q]!=this.view.id);)b=b.parentNode;return b!=this.domNode?b:null},findRowTarget:function(a){return this.findTarget(a,w)},
isIntraNodeEvent:function(a){try{return a.cellNode&&a.relatedTarget&&g.isDescendant(a.relatedTarget,a.cellNode)}catch(c){return!1}},isIntraRowEvent:function(a){try{var c=a.relatedTarget&&this.findRowTarget(a.relatedTarget);return!c&&-1==a.rowIndex||c&&a.rowIndex==c.gridRowIndex}catch(b){return!1}},dispatchEvent:function(a){return a.dispatch in this?this[a.dispatch](a):!1},domouseover:function(a){if(a.cellNode&&a.cellNode!=this.lastOverCellNode)this.lastOverCellNode=a.cellNode,this.grid.onMouseOver(a);
this.grid.onMouseOverRow(a)},domouseout:function(a){if(a.cellNode&&a.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(a,this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(a),!this.isIntraRowEvent(a)))this.grid.onMouseOutRow(a)},domousedown:function(a){if(a.cellNode)this.grid.onMouseDown(a);this.grid.onMouseDownRow(a)}}),r=m._ContentBuilder=j.extend(function(a){n.call(this,a)},n.prototype,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var a=this.grid.get,
c=this.view.structure.cells,b=0,f;f=c[b];b++)for(var e=0,d;d=f[e];e++)if(d.get=d.get||void 0==d.value&&a,d.markup=this.generateCellMarkup(d,d.cellStyles,d.cellClasses,!1),!this.grid.editable&&d.editable)this.grid.editable=!0},generateHtml:function(a,c){var b=this.getTableArray(),f=this.view.structure.cells,e=this.grid.getItem(c);p.fire(this.view,"onBeforeRow",[c,f]);for(var d=0,g;g=f[d];d++)if(!g.hidden&&!g.header){b.push(!g.invisible?"<tr>":'<tr class="dojoxGridInvisible">');for(var h=0,i,o,j,l;i=
g[h];h++)o=i.markup,j=i.customClasses=[],l=i.customStyles=[],o[5]=i.format(c,e),o[1]=j.join(" "),o[3]=l.join(";"),b.push.apply(b,o);b.push("</tr>")}b.push("</table>");return b.join("")},decorateEvent:function(a){a.rowNode=this.findRowTarget(a.target);if(!a.rowNode)return!1;a.rowIndex=a.rowNode[w];this.baseDecorateEvent(a);a.cell=this.grid.getCell(a.cellIndex);return!0}}),u=m._HeaderBuilder=j.extend(function(a){this.moveable=null;n.call(this,a)},n.prototype,{_skipBogusClicks:!1,overResizeWidth:4,minColWidth:1,
update:function(){this.tableMap?this.tableMap.mapRows(this.view.structure.cells):this.tableMap=new m._TableMap(this.view.structure.cells)},generateHtml:function(a,c){var b=this.getTableArray(),f=this.view.structure.cells;p.fire(this.view,"onBeforeRow",[-1,f]);for(var e=0,d;d=f[e];e++)if(!d.hidden){b.push(!d.invisible?"<tr>":'<tr class="dojoxGridInvisible">');for(var g=0,h,i;h=d[g];g++){h.customClasses=[];h.customStyles=[];if(this.view.simpleStructure){if(h.draggable)h.headerClasses?-1==h.headerClasses.indexOf("dojoDndItem")&&
(h.headerClasses+=" dojoDndItem"):h.headerClasses="dojoDndItem";h.attrs?-1==h.attrs.indexOf("dndType='gridColumn_")&&(h.attrs+=" dndType='gridColumn_"+this.grid.id+"'"):h.attrs="dndType='gridColumn_"+this.grid.id+"'"}i=this.generateCellMarkup(h,h.headerStyles,h.headerClasses,!0);i[5]=void 0!=c?c:a(h);i[3]=h.customStyles.join(";");i[1]=h.customClasses.join(" ");b.push(i.join(""))}b.push("</tr>")}b.push("</table>");return b.join("")},getCellX:function(a){var c,b=a.layerX;c=z(a.target,function(){if(!c||
c==a.cellNode)return!1;b+=0>c.offsetLeft?0:c.offsetLeft;return!0});return b},decorateEvent:function(a){this.baseDecorateEvent(a);a.rowIndex=-1;a.cellX=this.getCellX(a);return!0},prepareResize:function(a,c){do{var b=a.cellIndex;a.cellNode=b?a.cellNode.parentNode.cells[b+c]:null;a.cellIndex=a.cellNode?this.getCellNodeIndex(a.cellNode):-1}while(a.cellNode&&"none"==a.cellNode.style.display);return Boolean(a.cellNode)},canResize:function(a){if(!a.cellNode||1<a.cellNode.colSpan)return!1;a=this.grid.getCell(a.cellIndex);
return!a.noresize&&a.canResize()},overLeftResizeArea:function(a){return g.hasClass(l.body(),"dojoDndMove")?!1:this.grid.isLeftToRight()?0<a.cellIndex&&0<a.cellX&&a.cellX<this.overResizeWidth&&this.prepareResize(a,-1):a.cellNode&&0<a.cellX&&a.cellX<this.overResizeWidth},overRightResizeArea:function(a){return g.hasClass(l.body(),"dojoDndMove")?!1:this.grid.isLeftToRight()?a.cellNode&&a.cellX>=a.cellNode.offsetWidth-this.overResizeWidth:0<a.cellIndex&&a.cellX>=a.cellNode.offsetWidth-this.overResizeWidth&&
this.prepareResize(a,-1)},domousemove:function(a){if(!this.moveable){var c=this.overRightResizeArea(a)?"dojoxGridColResize":this.overLeftResizeArea(a)?"dojoxGridColResize":"";c&&!this.canResize(a)&&(c="dojoxGridColNoResize");g.toggleClass(a.sourceView.headerNode,"dojoxGridColNoResize","dojoxGridColNoResize"==c);g.toggleClass(a.sourceView.headerNode,"dojoxGridColResize","dojoxGridColResize"==c);c&&t.stop(a)}},domousedown:function(a){this.moveable||((this.overRightResizeArea(a)||this.overLeftResizeArea(a))&&
this.canResize(a)?this.beginColumnResize(a):(this.grid.onMouseDown(a),this.grid.onMouseOverRow(a)))},doclick:function(a){return this._skipBogusClicks?(t.stop(a),!0):!1},colResizeSetup:function(a,c){var b=g.contentBox(a.sourceView.headerNode);if(c){this.lineDiv=document.createElement("div");var f=g.position(a.sourceView.headerNode,!0),e=g.contentBox(a.sourceView.domNode),d=a.pageX;this.grid.isLeftToRight();g.style(this.lineDiv,{top:f.y+"px",left:d+"px",height:e.h+b.h+"px"});g.addClass(this.lineDiv,
"dojoxGridResizeColLine");this.lineDiv._origLeft=d;l.body().appendChild(this.lineDiv)}for(var f=[],e=this.tableMap.findOverlappingNodes(a.cellNode),d=0,k;k=e[d];d++)f.push({node:k,index:this.getCellNodeIndex(k),width:k.offsetWidth});e=a.sourceView;k=this.grid.isLeftToRight()?1:-1;for(var h=a.grid.views.views,d=[],i=e.idx+k,j;j=h[i];i+=k)d.push({node:j.headerNode,left:window.parseInt(j.headerNode.style.left)});k=e.headerContentNode.firstChild;return{scrollLeft:a.sourceView.headerNode.scrollLeft,view:e,
node:a.cellNode,index:a.cellIndex,w:g.contentBox(a.cellNode).w,vw:b.w,table:k,tw:g.contentBox(k).w,spanners:f,followers:d}},beginColumnResize:function(a){this.moverDiv=document.createElement("div");g.style(this.moverDiv,{position:"absolute",left:0});l.body().appendChild(this.moverDiv);g.addClass(this.grid.domNode,"dojoxGridColumnResizing");var c=this.moveable=new y(this.moverDiv),b=this.colResizeSetup(a,!0);c.onMove=j.hitch(this,"doResizeColumn",b);x.connect(c,"onMoveStop",j.hitch(this,function(){this.endResizeColumn(b);
b.node.releaseCapture&&b.node.releaseCapture();this.moveable.destroy();delete this.moveable;this.moveable=null;g.removeClass(this.grid.domNode,"dojoxGridColumnResizing")}));a.cellNode.setCapture&&a.cellNode.setCapture();c.onMouseDown(a)},doResizeColumn:function(a,c,b){var f=b.l,f={deltaX:f,w:a.w+(this.grid.isLeftToRight()?f:-f),vw:a.vw+f,tw:a.tw+f};this.dragRecord={inDrag:a,mover:c,leftTop:b};f.w>=this.minColWidth&&(c?g.style(this.lineDiv,"left",this.lineDiv._origLeft+f.deltaX+"px"):this.doResizeNow(a,
f))},endResizeColumn:function(a){if(this.dragRecord){var c=this.dragRecord.leftTop,c=this.grid.isLeftToRight()?c.l:-c.l,c=c+(Math.max(a.w+c,this.minColWidth)-(a.w+c));a.spanners.length&&(c+=g._getPadBorderExtents(a.spanners[0].node).w);this.doResizeNow(a,{deltaX:c,w:a.w+c,vw:a.vw+c,tw:a.tw+c});delete this.dragRecord}g.destroy(this.lineDiv);g.destroy(this.moverDiv);g.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=!0;a.view.update();this._skipBogusClicks=!1;this.grid.onResizeColumn(a.index)},
doResizeNow:function(a,c){a.view.convertColPctToFixed();if(a.view.flexCells&&!a.view.testFlexCells()){var b=v(a.node);if(b)b.style.width=""}for(var f,e,b=0;f=a.spanners[b];b++)if(e=f.width+c.deltaX,0<e)f.node.style.width=e+"px",a.view.setColWidth(f.index,e);this.grid.isLeftToRight();for(b=0;f=a.followers[b];b++)e=f.left+c.deltaX,f.node.style.left=e+"px";a.node.style.width=c.w+"px";a.view.setColWidth(a.index,c.w);a.view.headerNode.style.width=c.vw+"px";a.view.setColumnsWidth(c.tw);if(!this.grid.isLeftToRight())a.view.headerNode.scrollLeft=
a.scrollLeft+c.deltaX}});m._TableMap=j.extend(function(a){this.mapRows(a)},{map:null,mapRows:function(a){if(a.length){this.map=[];var c;for(c=0;a[c];c++)this.map[c]=[];for(var b=0;c=a[b];b++)for(var f=0,e=0,d,g;d=c[f];f++){for(;this.map[b][e];)e++;this.map[b][e]={c:f,r:b};g=d.rowSpan||1;d=d.colSpan||1;for(var h=0;h<g;h++)for(var i=0;i<d;i++)this.map[b+h][e+i]=this.map[b][e];e+=d}}},dumpMap:function(){for(var a=0,c;c=this.map[a];a++)for(var b=0;c[b];b++);},getMapCoords:function(a,c){for(var b=0,f;f=
this.map[b];b++)for(var e=0,d;d=f[e];e++)if(d.c==c&&d.r==a)return{j:b,i:e};return{j:-1,i:-1}},getNode:function(a,c,b){return(a=a&&a.rows[c])&&a.cells[b]},_findOverlappingNodes:function(a,c,b){var d;for(var f=[],c=this.getMapCoords(c,b),b=0,e;e=this.map[b];b++)b!=c.j&&(d=(e=e[c.i])?this.getNode(a,e.r,e.c):null,e=d)&&f.push(e);return f},findOverlappingNodes:function(a){return this._findOverlappingNodes(v(a),0<=a.parentNode.rowIndex?a.parentNode.rowIndex:s.indexOf(a.parentNode.parentNode.childNodes,
a.parentNode),0<=a.cellIndex?a.cellIndex:s.indexOf(a.parentNode.cells,a))}});return{_Builder:n,_HeaderBuilder:u,_ContentBuilder:r}});