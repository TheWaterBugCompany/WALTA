//>>built
define("dojox/treemap/TreeMap","dojo/_base/array,dojo/_base/lang,dojo/_base/declare,dojo/_base/event,dojo/_base/Color,dojo/touch,dojo/when,dojo/on,dojo/query,dojo/dom-construct,dojo/dom-geometry,dojo/dom-class,dojo/dom-style,./_utils,dijit/_WidgetBase,dojox/widget/_Invalidating,dojox/widget/Selection,dojo/_base/sniff,dojo/uacss".split(","),function(n,j,q,x,r,s,t,y,l,m,k,g,i,p,u,v,w){return q("dojox.treemap.TreeMap",[u,v,w],{baseClass:"dojoxTreeMap",store:null,query:{},itemToRenderer:null,_dataChanged:!1,
rootItem:null,_rootItemChanged:!1,tooltipAttr:"",areaAttr:"",_areaChanged:!1,labelAttr:"label",labelThreshold:NaN,colorAttr:"",colorModel:null,_coloringChanged:!1,groupAttrs:[],groupFuncs:null,_groupFuncs:null,_groupingChanged:!1,constructor:function(){this.itemToRenderer={};this.invalidatingProperties="colorModel,groupAttrs,groupFuncs,areaAttr,areaFunc,labelAttr,labelFunc,labelThreshold,tooltipAttr,tooltipFunc,colorAttr,colorFunc,rootItem".split(",")},getIdentity:function(a){return a.__treeID?a.__treeID:
this.store.getIdentity(a)},resize:function(a){a&&(k.setMarginBox(this.domNode,a),this.invalidateRendering())},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"mouseover",this._onMouseOver);this.connect(this.domNode,"mouseout",this._onMouseOut);this.connect(this.domNode,s.release,this._onMouseUp);this.domNode.setAttribute("role","presentation");this.domNode.setAttribute("aria-label","treemap")},buildRendering:function(){this.inherited(arguments);this.refreshRendering()},refreshRendering:function(){var a=
!1;if(this._dataChanged)this._dataChanged=!1,this._coloringChanged=this._groupingChanged=!0;if(this._groupingChanged)this._groupingChanged=!1,this._set("rootItem",null),this._updateTreeMapHierarchy(),a=!0;if(this._rootItemChanged)this._rootItemChanged=!1,a=!0;if(this._coloringChanged)this._coloringChanged=!1,null!=this.colorModel&&null!=this._data&&this.colorModel.initialize&&this.colorModel.initialize(this._data,j.hitch(this,function(a){return this.colorFunc(a,this.store)}));if(this._areaChanged)this._areaChanged=
!1,this._removeAreaForGroup();if(!(void 0==this.domNode||null==this._items)){a&&m.empty(this.domNode);var b=this.rootItem;if(null!=b&&this._isLeaf(b))b=this._getRenderer(b).parentItem;var c=k.getMarginBox(this.domNode);null!=b?this._buildRenderer(this.domNode,null,b,{x:c.l,y:c.t,w:c.w,h:c.h},0,a):this._buildChildrenRenderers(this.domNode,b?b:{__treeRoot:!0,children:this._items},0,a,c)}},_setRootItemAttr:function(a){this._rootItemChanged=!0;this._set("rootItem",a)},_setStoreAttr:function(a){var b;
null!=a?(b=a.query(this.query),b.observe&&b.observe(j.hitch(this,this._updateItem),!0),b=t(b,j.hitch(this,this._initItems))):b=this._initItems([]);this._set("store",a);return b},_initItems:function(a){this._dataChanged=!0;this._data=a;this.invalidateRendering();return a},_updateItem:function(a,b,c){-1!=b?c!=b?this._data.splice(b,1):this._data[c]=a:-1!=c&&this._data.splice(c,0,a);this._dataChanged=!0;this.invalidateRendering()},_setGroupAttrsAttr:function(a){this._groupingChanged=!0;if(null==this.groupFuncs)this._groupFuncs=
null!=a?n.map(a,function(a){return function(c){return c[a]}}):null;this._set("groupAttrs",a)},_setGroupFuncsAttr:function(a){this._groupingChanged=!0;this._set("groupFuncs",this._groupFuncs=a);if(null==a&&null!=this.groupAttrs)this._groupFuncs=n.map(this.groupAttrs,function(a){return function(c){return c[a]}})},_setAreaAttrAttr:function(a){this._areaChanged=!0;this._set("areaAttr",a)},areaFunc:function(a){return this.areaAttr&&0<this.areaAttr.length?parseFloat(a[this.areaAttr]):1},_setAreaFuncAttr:function(a){this._areaChanged=
!0;this._set("areaFunc",a)},labelFunc:function(a){return(a=this.labelAttr&&0<this.labelAttr.length?a[this.labelAttr]:null)?a.toString():null},tooltipFunc:function(a){return(a=this.tooltipAttr&&0<this.tooltipAttr.length?a[this.tooltipAttr]:null)?a.toString():null},_setColorModelAttr:function(a){this._coloringChanged=!0;this._set("colorModel",a)},_setColorAttrAttr:function(a){this._coloringChanged=!0;this._set("colorAttr",a)},colorFunc:function(a){a=this.colorAttr&&0<this.colorAttr.length?a[this.colorAttr]:
0;null==a&&(a=0);return parseFloat(a)},_setColorFuncAttr:function(a){this._coloringChanged=!0;this._set("colorFunc",a)},createRenderer:function(a,b,c){a=m.create("div");"header"!=c&&(i.set(a,"overflow","hidden"),i.set(a,"position","absolute"));return a},styleRenderer:function(a,b,c,d){switch(d){case "leaf":i.set(a,"background",this.getColorForItem(b).toHex());case "header":(b=this.getLabelForItem(b))&&(isNaN(this.labelThreshold)||c<this.labelThreshold)?a.innerHTML=b:m.empty(a)}},_updateTreeMapHierarchy:function(){if(null!=
this._data)this._items=null!=this._groupFuncs&&0<this._groupFuncs.length?p.group(this._data,this._groupFuncs,j.hitch(this,this._getAreaForItem)).children:this._data},_removeAreaForGroup:function(a){if(null!=a)if(a.__treeValue)delete a.__treeValue,a=a.children;else return;else a=this._items;if(a)for(var b=0;b<a.length;++b)this._removeAreaForGroup(a[b])},_getAreaForItem:function(a){a=this.areaFunc(a,this.store);return isNaN(a)?0:a},_computeAreaForItem:function(a){var b;if(a.__treeID){if(b=a.__treeValue,
!b){b=0;for(var c=a.children,d=0;d<c.length;++d)b+=this._computeAreaForItem(c[d]);a.__treeValue=b}}else b=this._getAreaForItem(a);return b},getColorForItem:function(a){a=this.colorFunc(a,this.store);return null!=this.colorModel?this.colorModel.getColor(a):new r(a)},getLabelForItem:function(a){return a.__treeName?a.__treeName:this.labelFunc(a,this.store)},_buildChildrenRenderers:function(a,b,c,d,e,g){var o=b.children,h=k.getMarginBox(a),h=p.solve(o,h.w,h.h,j.hitch(this,this._computeAreaForItem),!this.isLeftToRight()).rectangles;
e&&(h=n.map(h,function(a){a.x+=e.l;a.y+=e.t;return a}));for(var f,i=0;i<o.length;++i)f=h[i],this._buildRenderer(a,b,o[i],f,c,d,g)},_isLeaf:function(a){return!a.children},_isRoot:function(a){return a.__treeRoot},_getRenderer:function(a,b,c){if(b)for(b=0;b<c.children.length;++b)if(c.children[b].item==a)return c.children[b];return this.itemToRenderer[this.getIdentity(a)]},_buildRenderer:function(a,b,c,d,e,g,i){var h=this._isLeaf(c),f=!g?this._getRenderer(c,i,a):null,f=h?this._updateLeafRenderer(f,c,
e):this._updateGroupRenderer(f,c,e);if(g)f.level=e,f.item=c,f.parentItem=b,this.itemToRenderer[this.getIdentity(c)]=f,this.updateRenderers(c);var b=Math.floor(d.x),j=Math.floor(d.y),l=Math.floor(d.x+d.w+1.0E-11)-b,d=Math.floor(d.y+d.h+1.0E-11)-j;g&&m.place(f,a);k.setMarginBox(f,{l:b,t:j,w:l,h:d});h||(a=k.getContentBox(f),this._layoutGroupContent(f,a.w,a.h,e+1,g,i));this.onRendererUpdated({renderer:f,item:c,kind:h?"leaf":"group",level:e})},_layoutGroupContent:function(a,b,c,d,e,g){var j=l(".dojoxTreeMapHeader",
a)[0],h=l(".dojoxTreeMapGroupContent",a)[0];if(!(null==j||null==h)){var f=k.getMarginBox(j);f.h>c?(f.h=c,i.set(h,"display","none")):(i.set(h,"display","block"),k.setMarginBox(h,{l:0,t:f.h,w:b,h:c-f.h}),this._buildChildrenRenderers(h,a.item,d,e,null,g));k.setMarginBox(j,{l:0,t:0,w:b,h:f.h})}},_updateGroupRenderer:function(a,b,c){var d=null==a;null==a&&(a=this.createRenderer("div",c,"group"),g.add(a,"dojoxTreeMapGroup"));this.styleRenderer(a,b,c,"group");var e=l(".dojoxTreeMapHeader",a)[0],e=this._updateHeaderRenderer(e,
b,c);d&&m.place(e,a);e=l(".dojoxTreeMapGroupContent",a)[0];e=this._updateGroupContentRenderer(e,b,c);d&&m.place(e,a);return a},_updateHeaderRenderer:function(a,b,c){null==a&&(a=this.createRenderer(b,c,"header"),g.add(a,"dojoxTreeMapHeader"),g.add(a,"dojoxTreeMapHeader_"+c));this.styleRenderer(a,b,c,"header");return a},_updateLeafRenderer:function(a,b,c){null==a&&(a=this.createRenderer(b,c,"leaf"),g.add(a,"dojoxTreeMapLeaf"),g.add(a,"dojoxTreeMapLeaf_"+c));this.styleRenderer(a,b,c,"leaf");if(b=this.tooltipFunc(b,
this.store))a.title=b;return a},_updateGroupContentRenderer:function(a,b,c){null==a&&(a=this.createRenderer(b,c,"content"),g.add(a,"dojoxTreeMapGroupContent"),g.add(a,"dojoxTreeMapGroupContent_"+c));this.styleRenderer(a,b,c,"content");return a},_getRendererFromTarget:function(a){for(;a!=this.domNode&&!a.item;)a=a.parentNode;return a},_onMouseOver:function(a){var b=this._getRendererFromTarget(a.target);if(b.item){var c=b.item;this._hoveredItem=c;this.updateRenderers(c);this.onItemRollOver({renderer:b,
item:c,triggerEvent:a})}},_onMouseOut:function(a){var b=this._getRendererFromTarget(a.target);if(b.item){var c=b.item;this._hoveredItem=null;this.updateRenderers(c);this.onItemRollOut({renderer:b,item:c,triggerEvent:a})}},_onMouseUp:function(a){var b=this._getRendererFromTarget(a.target);b.item&&this.selectFromEvent(a,b.item,a.currentTarget,!0)},onRendererUpdated:function(){},onItemRollOver:function(){},onItemRollOut:function(){},updateRenderers:function(a){if(a){j.isArray(a)||(a=[a]);for(var b=0;b<
a.length;b++){var c=a[b],d=this._getRenderer(c);if(d){var e=this.isItemSelected(c);e?g.add(d,"dojoxTreeMapSelected"):g.remove(d,"dojoxTreeMapSelected");this._hoveredItem==c?g.add(d,"dojoxTreeMapHovered"):g.remove(d,"dojoxTreeMapHovered");e||this._hoveredItem==c?i.set(d,"zIndex",20):i.set(d,"zIndex","auto")}}}}})});