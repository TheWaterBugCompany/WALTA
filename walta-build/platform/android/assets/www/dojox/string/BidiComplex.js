//>>built
define("dojox/string/BidiComplex","dojo/_base/kernel,dojo/_base/lang,dojo/_base/array,dojo/_base/connect,dojo/_base/sniff,dojo/keys".split(","),function(n,o,l,j,p,h){n.experimental("dojox.string.BidiComplex");var c=o.getObject("string.BidiComplex",!0,dojox),m=[];c.attachInput=function(a,b){a.alt=b;j.connect(a,"onkeydown",this,"_ceKeyDown");j.connect(a,"onkeyup",this,"_ceKeyUp");j.connect(a,"oncut",this,"_ceCutText");j.connect(a,"oncopy",this,"_ceCopyText");a.value=c.createDisplayString(a.value,a.alt)};
c.createDisplayString=function(a,b){var a=c.stripSpecialCharacters(a),i=c._parse(a,b),d="\u202a"+a,g=1;l.forEach(i,function(a){if(null!=a){var b=d.substring(0,a+g),a=d.substring(a+g,d.length);d=b+"\u200e"+a;g++}});return d};c.stripSpecialCharacters=function(a){return a.replace(/[\u200E\u200F\u202A-\u202E]/g,"")};c._ceKeyDown=function(a){m=a.target.value};c._ceKeyUp=function(a){var b=a.target,i=b.value,d=a.keyCode;if(!(d==h.HOME||d==h.END||d==h.SHIFT)){var g,f;if(a=c._getCaretPos(a,b))g=a[0],f=a[1];
if(d==h.LEFT_ARROW)"\u200e"==i.charAt(f-1)&&c._setSelectedRange(b,g-1,f-1);else if(d==h.RIGHT_ARROW)"\u200e"==i.charAt(f-1)&&c._setSelectedRange(b,g+1,f+1);else if(a=c.createDisplayString(i,b.alt),i!=a){window.status=i+" c="+f;b.value=a;if(d==h.DELETE&&"\u200e"==a.charAt(f))b.value=a.substring(0,f)+a.substring(f+2,a.length);d==h.DELETE?c._setSelectedRange(b,g,f):d==h.BACKSPACE?m.length>=f&&"\u200e"==m.charAt(f-1)?c._setSelectedRange(b,g-1,f-1):c._setSelectedRange(b,g,f):"\u200e"!=b.value.charAt(f)&&
c._setSelectedRange(b,g+1,f+1)}}};c._processCopy=function(a,b){null==b&&(b=a.value.substring(a.selectionStart,a.selectionEnd));c.stripSpecialCharacters(b);return!0};c._ceCopyText=function(a){return c._processCopy(a,null,!1)};c._ceCutText=function(a){if(!c._processCopy(a,null,!1))return!1;var b=a.selectionStart;a.value=a.value.substring(0,b)+a.value.substring(a.selectionEnd);a.setSelectionRange(b,b);return!0};c._getCaretPos=function(a){return[a.target.selectionStart,a.target.selectionEnd]};c._setSelectedRange=
function(a,b,c){a.selectionStart=b;a.selectionEnd=c};var k=function(a,b,c){for(;0<b&&!(b==c);){b--;var d=a.charAt(b);if("0"<=d&&"9">=d||"\u00ff"<d)return!0;d=a.charAt(b);if("A"<=d&&"Z">=d||"a"<=d&&"z">=d)break}return!1};c._parse=function(a,b){var c=-1,d=[],g={FILE_PATH:"/\\:.",URL:"/:.?=&#",XPATH:"/\\:.<>=[]",EMAIL:"<>@.,;"}[b];switch(b){case "FILE_PATH":case "URL":case "XPATH":l.forEach(a,function(b,e){0<=g.indexOf(b)&&k(a,e,c)&&(c=e,d.push(e))});break;case "EMAIL":l.forEach(a,function(b,e){if('"'==
b){k(a,e,c)&&(c=e,d.push(e));e++;var h=a.indexOf('"',e);h>=e&&(e=h);k(a,e,c)&&(c=e,d.push(e))}0<=g.indexOf(b)&&k(a,e,c)&&(c=e,d.push(e))})}return d};return dojox.string.BidiComplex});