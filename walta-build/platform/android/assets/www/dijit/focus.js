//>>built
define("dijit/focus","dojo/aspect,dojo/_base/declare,dojo/dom,dojo/dom-attr,dojo/dom-construct,dojo/Evented,dojo/_base/lang,dojo/on,dojo/ready,dojo/sniff,dojo/Stateful,dojo/_base/unload,dojo/_base/window,dojo/window,./a11y,./registry,./main".split(","),function(l,q,m,r,n,s,i,v,t,w,u,x,o,p,y,j,k){var g=new (q([u,s],{curNode:null,activeStack:[],constructor:function(){var a=i.hitch(this,function(a){m.isDescendant(this.curNode,a)&&this.set("curNode",null);m.isDescendant(this.prevNode,a)&&this.set("prevNode",
null)});l.before(n,"empty",a);l.before(n,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,e){var c=this,d=function(a){c._justMouseDowned=!0;setTimeout(function(){c._justMouseDowned=!1},0);c._onTouchNode(e||a.target||a.srcElement,"mouse")},b=a.document;if(b){b.body.addEventListener("mousedown",d,!0);b.body.addEventListener("touchstart",d,!0);var f=function(a){c._onFocusNode(e||a.target)};b.addEventListener("focus",f,!0);var g=function(a){c._onBlurNode(e||
a.target)};b.addEventListener("blur",g,!0);return{remove:function(){b.body.removeEventListener("mousedown",d,!0);b.body.removeEventListener("touchstart",d,!0);b.removeEventListener("focus",f,!0);b.removeEventListener("blur",g,!0);b=null}}}},_onBlurNode:function(){this._clearFocusTimer&&clearTimeout(this._clearFocusTimer);this._clearFocusTimer=setTimeout(i.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0);if(!this._justMouseDowned)this._clearActiveWidgetsTimer&&
clearTimeout(this._clearActiveWidgetsTimer),this._clearActiveWidgetsTimer=setTimeout(i.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)},_onTouchNode:function(a,e){this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);var c=[];try{for(;a;){var d=r.get(a,"dijitPopupParent");if(d)a=j.byId(d).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===o.body())break;a=p.get(a.ownerDocument).frameElement}else{var b=
a.getAttribute&&a.getAttribute("widgetId"),f=b&&j.byId(b);f&&!("mouse"==e&&f.get("disabled"))&&c.unshift(b);a=a.parentNode}}}catch(g){}this._setStack(c,e)},_onFocusNode:function(a){a&&9!=a.nodeType&&(this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,e){var c=this.activeStack;this.set("activeStack",a);for(var d=0;d<Math.min(c.length,a.length)&&
!(c[d]!=a[d]);d++);for(var b,f=c.length-1;f>=d;f--)if(b=j.byId(c[f]))b._hasBeenBlurred=!0,b.set("focused",!1),b._focusManager==this&&b._onBlur(e),this.emit("widget-blur",b,e);for(f=d;f<a.length;f++)if(b=j.byId(a[f]))b.set("focused",!0),b._focusManager==this&&b._onFocus(e),this.emit("widget-focus",b,e)},focus:function(a){if(a)try{a.focus()}catch(e){}}}));t(function(){g.registerWin(p.get(o.doc))});k.focus=function(a){g.focus(a)};for(var h in g)/^_/.test(h)||(k.focus[h]="function"==typeof g[h]?i.hitch(g,
h):g[h]);g.watch(function(a,e,c){k.focus[a]=c});return g});