//>>built
define("dijit/_editor/plugins/LinkDialog","require,dojo/_base/declare,dojo/dom-attr,dojo/keys,dojo/_base/lang,dojo/sniff,dojo/_base/query,dojo/string,../../_Widget,../_Plugin,../../form/DropDownButton,../range".split(","),function(n,k,i,o,e,r,p,l,s,j,q){var h=k("dijit._editor.plugins.LinkDialog",j,{buttonClass:q,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"<?(mailto\\:)([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*>?",htmlTemplate:'<a href="${urlInput}" _djrealurl="${urlInput}" target="${targetSelect}">${textInput}</a>',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,linkDialogTemplate:"<table role='presentation'><tr><td><label for='${id}_urlInput'>${url}</label></td><td><input data-dojo-type='dijit.form.ValidationTextBox' required='true' id='${id}_urlInput' name='urlInput' data-dojo-props='intermediateChanges:true'/></td></tr><tr><td><label for='${id}_textInput'>${text}</label></td><td><input data-dojo-type='dijit.form.ValidationTextBox' required='true' id='${id}_textInput' name='textInput' data-dojo-props='intermediateChanges:true'/></td></tr><tr><td><label for='${id}_targetSelect'>${target}</label></td><td><select id='${id}_targetSelect' name='targetSelect' data-dojo-type='dijit.form.Select'><option selected='selected' value='_self'>${currentWindow}</option><option value='_blank'>${newWindow}</option><option value='_top'>${topWindow}</option><option value='_parent'>${parentWindow}</option></select></td></tr><tr><td colspan='2'><button data-dojo-type='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button><button data-dojo-type='dijit.form.Button' type='button' id='${id}_cancelButton'>${buttonCancel}</button></td></tr></table>",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=e.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(a){n("dojo/i18n,../../TooltipDialog,../../registry,../../form/Button,../../form/Select,../../form/ValidationTextBox,dojo/i18n!../../nls/common,dojo/i18n!../nls/LinkDialog".split(","),e.hitch(this,function(c,b,d){var g=this;this.tag="insertImage"==this.command?"img":"a";var c=e.delegate(c.getLocalization("dijit","common",this.lang),c.getLocalization("dijit._editor",
"LinkDialog",this.lang)),f=this.dropDown=this.button.dropDown=new b({title:c[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:e.hitch(this,"setValue"),onOpen:function(){g._onOpenDialog();b.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(e.hitch(g,"_onCloseDialog"),0)}});c.urlRegExp=this.urlRegExp;c.id=d.getUniqueId(this.editor.id);this._uniqueId=c.id;this._setContent(f.title+"<div style='border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'></div>"+
l.substitute(this.linkDialogTemplate,c));f.startup();this._urlInput=d.byId(this._uniqueId+"_urlInput");this._textInput=d.byId(this._uniqueId+"_textInput");this._setButton=d.byId(this._uniqueId+"_setButton");this.connect(d.byId(this._uniqueId+"_cancelButton"),"onClick",function(){this.dropDown.onCancel()});this._urlInput&&this.connect(this._urlInput,"onChange","_checkAndFixInput");this._textInput&&this.connect(this._textInput,"onChange","_checkAndFixInput");this._urlRegExp=RegExp("^"+this.urlRegExp+
"$","i");this._emailRegExp=RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=e.hitch(this,function(){var a=this._urlInput.get("value");return this._urlRegExp.test(a)||this._emailRegExp.test(a)});this.connect(f.domNode,"onkeypress",function(a){a&&a.charOrCode==o.ENTER&&!a.shiftKey&&!a.metaKey&&!a.ctrlKey&&!a.altKey&&!this._setButton.get("disabled")&&(f.onExecute(),f.execute(f.get("value")))});a()}))},_checkAndFixInput:function(){var a=this,c=this._urlInput.get("value");if(this._delayedCheck)clearTimeout(this._delayedCheck),
this._delayedCheck=null;this._delayedCheck=setTimeout(function(){var b=c,d=!1,g=!1;b&&1<b.length&&(b=e.trim(b),0!==b.indexOf("mailto:")&&(0<b.indexOf("/")?-1===b.indexOf("://")&&"/"!==b.charAt(0)&&b.indexOf("./")&&0!==b.indexOf("../")&&a._hostRxp.test(b)&&(d=!0):a._userAtRxp.test(b)&&(g=!0)));d&&a._urlInput.set("value","http://"+b);g&&a._urlInput.set("value","mailto:"+b);a._setButton.set("disabled",!a._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(e.hitch(this,function(){this.connect(this.editor.editNode,
"ondblclick",this._onDblClick)}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(a){this.dropDown.set({parserScope:"dojo",content:a})},_checkValues:function(a){if(a&&a.urlInput)a.urlInput=a.urlInput.replace(/"/g,"&quot;");return a},setValue:function(a){this._onCloseDialog();a=this._checkValues(a);this.editor.execCommand("inserthtml",l.substitute(this.htmlTemplate,a));p("a",this.editor.document).forEach(function(a){!a.innerHTML&&!i.has(a,"name")&&
a.parentNode.removeChild(a)},this)},_onCloseDialog:function(){this.editor.focus()},_getCurrentValues:function(a){var c,b,d;a&&a.tagName.toLowerCase()===this.tag?(c=a.getAttribute("_djrealurl")||a.getAttribute("href"),d=a.getAttribute("target")||"_self",b=a.textContent||a.innerText,this.editor._sCall("selectElement",[a,!0])):b=this.editor._sCall("getSelectedText");return{urlInput:c||"",textInput:b||"",targetSelect:d||""}},_onOpenDialog:function(){var a;a=this.editor._sCall("getAncestorElement",[this.tag]);
this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(a))},_onDblClick:function(a){if(a&&a.target&&(a=a.target,(a.tagName?a.tagName.toLowerCase():"")===this.tag&&i.get(a,"href"))){var c=this.editor;this.editor._sCall("selectElement",[a]);c.onDisplayChanged();c._updateTimer&&(c._updateTimer.remove(),delete c._updateTimer);c.onNormalizedDisplayChanged();var b=this.button;setTimeout(function(){b.set("disabled",!1);b.loadAndOpenDropDown().then(function(){b.dropDown.focus&&
b.dropDown.focus()})},10)}}}),m=k("dijit._editor.plugins.ImgLinkDialog",[h],{linkDialogTemplate:"<table role='presentation'><tr><td><label for='${id}_urlInput'>${url}</label></td><td><input dojoType='dijit.form.ValidationTextBox' regExp='${urlRegExp}' required='true' id='${id}_urlInput' name='urlInput' data-dojo-props='intermediateChanges:true'/></td></tr><tr><td><label for='${id}_textInput'>${text}</label></td><td><input data-dojo-type='dijit.form.ValidationTextBox' required='false' id='${id}_textInput' name='textInput' data-dojo-props='intermediateChanges:true'/></td></tr><tr><td></td><td></td></tr><tr><td colspan='2'><button data-dojo-type='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button><button data-dojo-type='dijit.form.Button' type='button' id='${id}_cancelButton'>${buttonCancel}</button></td></tr></table>",
htmlTemplate:'<img src="${urlInput}" _djrealurl="${urlInput}" alt="${textInput}" />',tag:"img",_getCurrentValues:function(a){var c,b;a&&a.tagName.toLowerCase()===this.tag?(c=a.getAttribute("_djrealurl")||a.getAttribute("src"),b=a.getAttribute("alt"),this.editor._sCall("selectElement",[a,!0])):b=this.editor._sCall("getSelectedText",[]);return{urlInput:c||"",textInput:b||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);this.editor.onLoadDeferred.then(e.hitch(this,
function(){this.connect(this.editor.editNode,"onmousedown",this._selectTag)}))},_selectTag:function(a){if(a&&a.target)a=a.target,(a.tagName?a.tagName.toLowerCase():"")===this.tag&&this.editor._sCall("selectElement",[a])},_checkValues:function(a){if(a&&a.urlInput)a.urlInput=a.urlInput.replace(/"/g,"&quot;");if(a&&a.textInput)a.textInput=a.textInput.replace(/"/g,"&quot;");return a},_onDblClick:function(a){if(a&&a.target&&(a=a.target,(a.tagName?a.tagName.toLowerCase():"")===this.tag&&i.get(a,"src"))){var c=
this.editor;this.editor._sCall("selectElement",[a]);c.onDisplayChanged();c._updateTimer&&(c._updateTimer.remove(),delete c._updateTimer);c.onNormalizedDisplayChanged();var b=this.button;setTimeout(function(){b.set("disabled",!1);b.loadAndOpenDropDown().then(function(){b.dropDown.focus&&b.dropDown.focus()})},10)}}});j.registry.createLink=function(){return new h({command:"createLink"})};j.registry.insertImage=function(){return new m({command:"insertImage"})};h.ImgLinkDialog=m;return h});