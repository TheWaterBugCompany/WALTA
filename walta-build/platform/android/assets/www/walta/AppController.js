//>>built
define("walta/AppController","dojo/_base/declare,dojo/_base/lang,dojo/dom-construct,dojo/aspect,dojo/topic,walta/Key,walta/KeyNode,walta/Taxon,walta/KeyNodeView,walta/TaxonView,walta/HomeView,walta/SpeedBug,walta/SpeedBugView".split(","),function(f,b,d,e,c,g,h,i,j,k,l,m,n){return f(null,{keyUrl:"",divNode:null,_key:null,_speedBug:null,_currentView:null,_views:{},_decisionCounter:0,_decisionViews:[],constructor:function(a){f.safeMixin(this,a);this._key=new g({url:this.keyUrl})},_startAltKey:function(){this._doTransition(this._createDecisionView(),
1)},_questionChosen:function(a){this._key.choose(a);this._doTransition(this._createDecisionView(),1)},_goBack:function(){this._key.back()?this._doTransition(this._createDecisionView(),-1):this._doTransition(this._views.home,-1)},_doTransition:function(a,b){this._currentView.performTransition(a.get("id"),b,"slide");this._currentView=a},_createDecisionView:function(){var a=null,c=d.create("div",{id:"waltaDecisionView"+this._decisionCounter++},this.divNode);this._key.currentDecision instanceof h?(a=
new j({keyNode:this._key.currentDecision},c),e.after(a,"onChoose",b.hitch(this,this._questionChosen),!0),e.after(a,"onBack",b.hitch(this,this._goBack),!0)):this._key.currentDecision instanceof i&&(a=new k({taxon:this._key.currentDecision},c),e.after(a,"onBack",b.hitch(this,this._goBack),!0));a.startup();this._decisionViews.unshift(a);2<this._decisionViews.length&&(this._decisionViews.pop().destroyRecursive(),this._decisionCounter%=3);return a},_createHomeView:function(){var a=new l({selected:!0},
d.create("div",{id:"waltaHomeView"},this.divNode));this._views.home=a;a.startup();this._currentView=a},_createSpeedBug:function(){this._speedBug=new m(this._key.url,this._key._xml);var a=new n({speedBug:this._speedBug},d.create("div",{id:"waltaSpeedBug"},this.divNode));this._views.speedBug=a;a.startup()},startApp:function(){this._key.load().then(b.hitch(this,this._createHomeView)).then(b.hitch(this,this._createSpeedBug));c.subscribe("anchorbar/home",b.hitch(this,function(){this._doTransition(this._views.home,
-1)}));c.subscribe("key/jump",b.hitch(this,function(a){this._key.lookupNode(a);this._doTransition(this._createDecisionView(),1)}));c.subscribe("key/start",b.hitch(this,function(){this._key.reset();this._startAltKey()}));c.subscribe("speedbug/open",b.hitch(this,function(){this._doTransition(this._views.speedBug,1)}))}})});