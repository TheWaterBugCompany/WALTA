//>>built
define("dojo/_base/xhr","./kernel,./sniff,require,../io-query,../dom,../dom-form,./Deferred,./config,./json,./lang,./array,../on,../aspect,../request/watch,../request/xhr,../request/util".split(","),function(b,B,C,l,u,e,v,w,q,k,D,E,r,j,s,x){b._xhrObj=s._create;var o=b.config;b.objectToQuery=l.objectToQuery;b.queryToObject=l.queryToObject;b.fieldToObject=e.fieldToObject;b.formToObject=e.toObject;b.formToQuery=e.toQuery;b.formToJson=e.toJson;b._blockAsync=!1;var n=b._contentHandlers=b.contentHandlers=
{text:function(a){return a.responseText},json:function(a){return q.fromJson(a.responseText||null)},"json-comment-filtered":function(a){w.useCommentedJson||console.warn("Consider using the standard mimetype:application/json. json-commenting can introduce security issues. To decrease the chances of hijacking, use the standard the 'json' handler and prefix your json with: {}&&\nUse djConfig.useCommentedJson=true to turn off this message.");var a=a.responseText,b=a.indexOf("/*"),m=a.lastIndexOf("*/");
if(-1==b||-1==m)throw Error("JSON was not comment filtered");return q.fromJson(a.substring(b+2,m))},javascript:function(a){return b.eval(a.responseText)},xml:function(a){return a.responseXML},"json-comment-optional":function(a){return a.responseText&&/^[^{\[]*\/\*/.test(a.responseText)?n["json-comment-filtered"](a):n.json(a)}};b._ioSetArgs=function(a,c,m,y){var d={args:a,url:a.url},f=null;if(a.form){var f=u.byId(a.form),g=f.getAttributeNode("action");d.url=d.url||(g?g.value:null);f=e.toObject(f)}g=
[{}];f&&g.push(f);a.content&&g.push(a.content);a.preventCache&&g.push({"dojo.preventCache":(new Date).valueOf()});d.query=l.objectToQuery(k.mixin.apply(null,g));d.handleAs=a.handleAs||"text";var i=new v(function(a){a.canceled=!0;c&&c(a);var b=a.ioArgs.error;if(!b)b=Error("request cancelled"),b.dojoType="cancel",a.ioArgs.error=b;return b});i.addCallback(m);var p=a.load;p&&k.isFunction(p)&&i.addCallback(function(b){return p.call(a,b,d)});var h=a.error;h&&k.isFunction(h)&&i.addErrback(function(b){return h.call(a,
b,d)});var j=a.handle;j&&k.isFunction(j)&&i.addBoth(function(b){return j.call(a,b,d)});i.addErrback(function(a){return y(a,i)});o.ioPublish&&b.publish&&!1!==d.args.ioPublish&&(i.addCallbacks(function(a){b.publish("/dojo/io/load",[i,a]);return a},function(a){b.publish("/dojo/io/error",[i,a]);return a}),i.addBoth(function(a){b.publish("/dojo/io/done",[i,a]);return a}));i.ioArgs=d;return i};var z=function(a){a=n[a.ioArgs.handleAs](a.ioArgs.xhr);return void 0===a?null:a},A=function(a,b){b.ioArgs.args.failOk||
console.error(a);return a},t=function(a){0>=h&&(h=0,o.ioPublish&&b.publish&&(!a||a&&!1!==a.ioArgs.args.ioPublish)&&b.publish("/dojo/io/stop"))},h=0;r.after(j,"_onAction",function(){h-=1});r.after(j,"_onInFlight",t);b._ioCancelAll=j.cancelAll;b._ioNotifyStart=function(a){o.ioPublish&&b.publish&&!1!==a.ioArgs.args.ioPublish&&(h||b.publish("/dojo/io/start"),h+=1,b.publish("/dojo/io/send",[a]))};b._ioWatch=function(a,b,h,e){a.ioArgs.options=a.ioArgs.args;k.mixin(a,{response:a.ioArgs,isValid:function(){return b(a)},
isReady:function(){return h(a)},handleResponse:function(){return e(a)}});j(a);t(a)};b._ioAddQueryToUrl=function(a){if(a.query.length)a.url+=(-1==a.url.indexOf("?")?"?":"&")+a.query,a.query=null};b.xhr=function(a,c,h){var e,d=b._ioSetArgs(c,function(){e&&e.cancel()},z,A),f=d.ioArgs;"postData"in c?f.query=c.postData:"putData"in c?f.query=c.putData:"rawBody"in c?f.query=c.rawBody:(2<arguments.length&&!h||-1==="POST|PUT".indexOf(a.toUpperCase()))&&b._ioAddQueryToUrl(f);var g={method:a,handleAs:"text",
timeout:c.timeout,withCredentials:c.withCredentials,ioArgs:f};if("undefined"!==typeof c.headers)g.headers=c.headers;if("undefined"!==typeof c.contentType){if(!g.headers)g.headers={};g.headers["Content-Type"]=c.contentType}if("undefined"!==typeof f.query)g.data=f.query;if("undefined"!==typeof c.sync)g.sync=c.sync;b._ioNotifyStart(d);try{e=s(f.url,g,!0)}catch(i){return d.cancel(),d}d.ioArgs.xhr=e.response.xhr;e.then(function(){d.resolve(d)}).otherwise(function(a){f.error=a;if(a.response)a.status=a.response.status,
a.responseText=a.response.text,a.xhr=a.response.xhr;d.reject(a)});return d};b.xhrGet=function(a){return b.xhr("GET",a)};b.rawXhrPost=b.xhrPost=function(a){return b.xhr("POST",a,!0)};b.rawXhrPut=b.xhrPut=function(a){return b.xhr("PUT",a,!0)};b.xhrDelete=function(a){return b.xhr("DELETE",a)};b._isDocumentOk=function(a){return x.checkStatus(a.status)};b._getText=function(a){var c;b.xhrGet({url:a,sync:!0,load:function(a){c=a}});return c};k.mixin(b.xhr,{_xhrObj:b._xhrObj,fieldToObject:e.fieldToObject,
formToObject:e.toObject,objectToQuery:l.objectToQuery,formToQuery:e.toQuery,formToJson:e.toJson,queryToObject:l.queryToObject,contentHandlers:n,_ioSetArgs:b._ioSetArgs,_ioCancelAll:b._ioCancelAll,_ioNotifyStart:b._ioNotifyStart,_ioWatch:b._ioWatch,_ioAddQueryToUrl:b._ioAddQueryToUrl,_isDocumentOk:b._isDocumentOk,_getText:b._getText,get:b.xhrGet,post:b.xhrPost,put:b.xhrPut,del:b.xhrDelete});return b.xhr});