//>>built
define("dojo/request/xhr",["../errors/RequestError","./watch","./handlers","./util","../has"],function(m,t,n,f,k){function u(a,b){var c=a.xhr;a.status=a.xhr.status;a.text=c.responseText;if("xml"===a.options.handleAs)a.data=c.responseXML;if(!b)try{n(a)}catch(d){b=d}b?this.reject(b):f.checkStatus(c.status)?this.resolve(a):(b=new m("Unable to load "+a.url+" status: "+c.status,a),this.reject(b))}function i(a,b,c){var d=f.parseArgs(a,f.deepCreate(v,b),k("native-formdata")&&b&&b.data&&b.data instanceof
FormData),a=d.url,b=d.options,o,e=f.deferred(d,p,q,s,u,function(){o&&o()}),g=d.xhr=i._create();if(!g)return e.cancel(new m("XHR was not created")),c?e:e.promise;d.getHeader=function(a){return this.xhr.getResponseHeader(a)};r&&(o=r(g,e,d));var n=b.data,w=!b.sync,x=b.method;try{g.open(x,a,w,b.user||void 0,b.password||void 0);if(b.withCredentials)g.withCredentials=b.withCredentials;var h=b.headers,l;if(h)for(var j in h)"content-type"===j.toLowerCase()?l=h[j]:h[j]&&g.setRequestHeader(j,h[j]);l&&!1!==
l&&g.setRequestHeader("Content-Type",l);(!h||!("X-Requested-With"in h))&&g.setRequestHeader("X-Requested-With","XMLHttpRequest");f.notify&&f.notify.emit("send",d,e.promise.cancel);g.send(n)}catch(y){e.reject(y)}t(e);g=null;return c?e:e.promise}k.add("native-xhr2",function(){var a=new XMLHttpRequest;return"undefined"!==typeof a.addEventListener&&("undefined"===typeof opera||"undefined"!==typeof a.upload)});k.add("native-formdata",function(){return"function"===typeof FormData});var q,s,r,p;k("native-xhr2")?
(q=function(){return!this.isFulfilled()},p=function(a,b){b.xhr.abort()},r=function(a,b,c){function d(){b.handleResponse(c)}function f(a){a=new m("Unable to load "+c.url+" status: "+a.target.status,c);b.handleResponse(c,a)}function e(a){if(a.lengthComputable)c.loaded=a.loaded,c.total=a.total,b.progress(c)}a.addEventListener("load",d,!1);a.addEventListener("error",f,!1);a.addEventListener("progress",e,!1);return function(){a.removeEventListener("load",d,!1);a.removeEventListener("error",f,!1);a.removeEventListener("progress",
e,!1)}}):(q=function(a){return a.xhr.readyState},s=function(a){return 4===a.xhr.readyState},p=function(a,b){var c=b.xhr,d=typeof c.abort;("function"===d||"object"===d||"unknown"===d)&&c.abort()});var v={data:null,query:null,sync:!1,method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}};i._create=function(){throw Error("XMLHTTP not available");};i._create=function(){return new XMLHttpRequest};f.addCommonMethods(i);return i});